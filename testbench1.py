# -*- coding: utf-8 -*-
## Inicializaci√≥n del Notebook del TP4

import numpy as np
from pandas import DataFrame
from IPython.display import HTML
from scipy import signal as sig
from  matplotlib import patches
import matplotlib as mpl
import scipy.io as scipyio
import matplotlib.pyplot as plt
import scipy.fftpack as sc 

def zplane(b,a,filename=None):
    """Plot the complex z-plane given a transfer function.
    """

    # get a figure/plot
    ax = plt.subplot(111)

    # create the unit circle
    uc = patches.Circle((0,0), radius=1, fill=False,
                        color='black', ls='dashed')
    ax.add_patch(uc)

    # The coefficients are less than 1, normalize the coeficients
    if np.max(b) > 1:
        kn = np.max(b)
        b = b/float(kn)
    else:
        kn = 1

    if np.max(a) > 1:
        kd = np.max(a)
        a = a/float(kd)
    else:
        kd = 1
        
    # Get the poles and zeros
    p = np.roots(a)
    z = np.roots(b)
    k = kn/float(kd)
    
    # Plot the zeros and set marker properties    
    t1 = plt.plot(z.real, z.imag, 'go', ms=10)
    plt.setp( t1, markersize=10.0, markeredgewidth=1.0,
              markeredgecolor='k', markerfacecolor='g')

    # Plot the poles and set marker properties
    t2 = plt.plot(p.real, p.imag, 'rx', ms=10)
    plt.setp( t2, markersize=12.0, markeredgewidth=3.0,
              markeredgecolor='r', markerfacecolor='r')

    ax.spines['left'].set_position('center')
    ax.spines['bottom'].set_position('center')
    ax.spines['right'].set_visible(False)
    ax.spines['top'].set_visible(False)

    # set the ticks
    r = 1.5; plt.axis('scaled'); plt.axis([-r, r, -r, r])
    ticks = [-1, -.5, .5, 1]; plt.xticks(ticks); plt.yticks(ticks)

    if filename is None:
        plt.show()
    else:
        plt.savefig(filename)
    

    return z, p, k


#ecg_lead: Registro de ECG muestreado a  ùëìùë†=1  KHz durante una prueba de esfuerzo
#qrs_pattern1: Complejo de ondas QRS normal
#heartbeat_pattern1: Latido normal
#heartbeat_pattern2: Latido de origen ventricular
#qrs_detections: vector con las localizaciones (en # de muestras) donde ocurren los latidos
mat = scipyio.loadmat('ECG_TP4.mat')

ecg_lead = mat['ecg_lead']  
qrs_pattern1 = mat['qrs_pattern1']
heartbeat_pattern1 = mat['heartbeat_pattern1']
heartbeat_pattern2 = mat['heartbeat_pattern2']
qrs_detections = mat['qrs_detections']

fs = 1000 #1KHz
ts = 1/fs

zonas_con_interf_baja_frec = ( 
        np.array([12, 12.4]) *60*fs, # minutos a muestras
        np.array([15, 15.2]) *60*fs, # minutos a muestras
        )

zonas_sin_interf = ( 
        np.array([5, 5.2]) *60*fs, # minutos a muestras
        [4000, 5500], # muestras
        [10e3, 11e3], # muestras
        )


ecg_In = int(zonas_sin_interf[0][0])
ecg_Fin = int(zonas_sin_interf[0][1]) #len(ecg_lead)
N = len(ecg_lead[ecg_In:ecg_Fin])
tt = np.linspace(0, (N-1)*ts, N).flatten()


a_pb_fir = np.array([1])
#FSB = 0.095 ; FSA = 0.105; ASB = 0.01 ; APB = 80; N = 416
b_pb_fir = [-2.074177292689992e-05,
5.193916271655597e-05,
6.0028929683799436e-05,
7.317347502069934e-05,
7.680362841199955e-05,
6.476841767566013e-05,
3.7466211871742756e-05,
1.3334116578110678e-06,
-3.303156454135562e-05,
-5.430582462814517e-05,
-5.464014069634055e-05,
-3.300000601780741e-05,
3.6343548552951894e-06,
4.209753196961257e-05,
6.740265708245563e-05,
6.836603129366665e-05,
4.228625562544283e-05,
-3.137610177449979e-06,
-5.184652785067904e-05,
-8.489610072249166e-05,
-8.769956331509131e-05,
-5.6189002068144863e-05,
5.052577304131818e-07,
6.243816098384975e-05,
0.00010566812145669043,
0.0001114016598748754,
7.386768414899316e-05,
3.865951248137725e-06,
-7.401805979045885e-05,
-0.00012981435123603867,
-0.0001395944530040779,
-9.542270322675681e-05,
-9.988415183929545e-06,
8.66845042794267e-05,
0.00015752965031084936,
0.0001725594435567163,
0.00012118754255503934,
1.8120456685423787e-05,
-0.00010044750045102252,
-0.0001891631140968354,
-0.00021084602382096792,
-0.00015159356431734114,
-2.8465172147687425e-05,
0.00011533259080876172,
0.00022502794915481183,
0.0002548620717139718,
0.00018726796772127336,
4.1363165213668975e-05,
-0.00013142989301547756,
-0.00026542582845891916,
-0.0003052881461226832,
-0.00022865773525297475,
-5.7201132203636456e-05,
0.0001486489144024993,
0.0003107601137474576,
0.0003626385302978364,
0.0002764086208137364,
7.634416838275095e-05,
-0.00016701231204550355,
-0.0003614263201799131,
-0.0004276123819887451,
-0.00033122877848323397,
-9.926550983683102e-05,
0.00018645193908209287,
0.0004177818231984341,
0.000500864607721646,
0.00039382669238327805,
0.00012644384781839853,
-0.0002069328024442442,
-0.00048027292277884754,
-0.0005831618463225034,
-0.0004649929238115654,
-0.00015840098545483847,
0.00022839019289237243,
0.0005493256107524179,
0.0006752875891558256,
0.0005455940710153611,
0.00019574147116968918,
-0.00025074213743846857,
-0.0006254195152882695,
-0.000778091847475933,
-0.0006365186915251346,
-0.0002390663542142938,
0.00027391522463083456,
0.000709103059810356,
0.0008925504915763667,
0.0007388370199409955,
0.0002890888341725964,
-0.00029785371890452667,
-0.0008009639879952011,
-0.0010197901001975135,
-0.0008537228807992812,
-0.0003466313282958727,
0.00032241792960683256,
0.0009016983083906841,
0.0011610073442692797,
0.0009825216562031713,
0.00041262562806862577,
-0.0003474809569233346,
-0.0010120409764540587,
-0.00131759054013331,
-0.00112672459734785,
-0.00048810081017726934,
0.0003728983777711915,
0.0011328440839743217,
0.001491108991609888,
0.0012880415983195486,
0.0005742251236691491,
-0.00039855658847037984,
-0.0012651632658027155,
-0.0016834392177065517,
-0.0014684721212733468,
-0.0006723342545725874,
0.0004243711264276928,
0.001410317281514996,
0.0018969095024372164,
0.0016705190528383644,
0.0007841224796464358,
-0.00045018906538656344,
-0.0015698651486301504,
-0.0021343148817604537,
-0.0018972251744157108,
-0.0009117309558985052,
0.0004756514378608688,
0.0017454690431127737,
0.0023987473866366694,
0.002151904340153304,
0.0010572749277538746,
-0.0005009204529823168,
-0.0019398041036794904,
-0.002694705924877506,
-0.002439318735208101,
-0.0012239992170561096,
0.000525607208890464,
0.002155733739746045,
0.0030273506824015544,
0.0027650508417155426,
0.0014156148392235445,
-0.0005496467078081387,
-0.002397263894170675,
-0.003403641446104243,
-0.003136514876073335,
-0.0016370560562221329,
0.0005728590605685188,
0.0026696087757061442,
0.0038326938683258443,
0.003563478217229625,
0.001894820433904737,
-0.0005950875084871159,
-0.0029798129566727142,
-0.004326791618364238,
-0.0040591103279442094,
-0.0021976715164509554,
0.0006161858477865331,
0.003337614445540746,
0.004902936021956712,
0.004641694958296074,
0.002557800463779555,
-0.0006360065619734054,
-0.0037567908765945555,
-0.005585264259808361,
-0.005337317544217728,
-0.00299267848703916,
0.0006544035464186986,
0.004257492512324126,
0.006409241762923419,
0.006184548142084853,
0.0035282996632739314,
-0.0006712381224812538,
-0.004870315301963203,
-0.007429129402529919,
-0.007242869849957677,
-0.00420505640028145,
0.0006864108111881572,
0.005644088281179007,
0.008732319937993048,
0.008609177668538238,
0.005089556349518375,
-0.0006997695218352315,
-0.006661377992310655,
-0.010468743980109824,
-0.010452174143722572,
-0.006299531772779349,
0.0007112844836086692,
0.008074004961935772,
0.0129192268658798,
0.013094422957501295,
0.008065180028074622,
-0.0007208053717656124,
-0.01019369360972075,
-0.016676828397926134,
-0.017238150042344743,
-0.010904441382212837,
0.0007282688377118518,
0.013778083595476921,
0.02324776861936754,
0.02475664469279637,
0.016277322525823833,
-0.0007336466372733257,
-0.021269173337321406,
-0.037904950983306464,
-0.042876657058290274,
-0.03051131460051924,
0.0007368960011259578,
0.047320326374785296,
0.10107672060278834,
0.15109638530514674,
0.18648819168562217,
0.1992620158469986,
0.18648819168562217,
0.15109638530514674,
0.10107672060278834,
0.047320326374785296,
0.0007368960011259578,
-0.03051131460051924,
-0.042876657058290274,
-0.037904950983306464,
-0.021269173337321406,
-0.0007336466372733257,
0.016277322525823833,
0.02475664469279637,
0.02324776861936754,
0.013778083595476921,
0.0007282688377118518,
-0.010904441382212837,
-0.017238150042344743,
-0.016676828397926134,
-0.01019369360972075,
-0.0007208053717656124,
0.008065180028074622,
0.013094422957501295,
0.0129192268658798,
0.008074004961935772,
0.0007112844836086692,
-0.006299531772779349,
-0.010452174143722572,
-0.010468743980109824,
-0.006661377992310655,
-0.0006997695218352315,
0.005089556349518375,
0.008609177668538238,
0.008732319937993048,
0.005644088281179007,
0.0006864108111881572,
-0.00420505640028145,
-0.007242869849957677,
-0.007429129402529919,
-0.004870315301963203,
-0.0006712381224812538,
0.0035282996632739314,
0.006184548142084853,
0.006409241762923419,
0.004257492512324126,
0.0006544035464186986,
-0.00299267848703916,
-0.005337317544217728,
-0.005585264259808361,
-0.0037567908765945555,
-0.0006360065619734054,
0.002557800463779555,
0.004641694958296074,
0.004902936021956712,
0.003337614445540746,
0.0006161858477865331,
-0.0021976715164509554,
-0.0040591103279442094,
-0.004326791618364238,
-0.0029798129566727142,
-0.0005950875084871159,
0.001894820433904737,
0.003563478217229625,
0.0038326938683258443,
0.0026696087757061442,
0.0005728590605685188,
-0.0016370560562221329,
-0.003136514876073335,
-0.003403641446104243,
-0.002397263894170675,
-0.0005496467078081387,
0.0014156148392235445,
0.0027650508417155426,
0.0030273506824015544,
0.002155733739746045,
0.000525607208890464,
-0.0012239992170561096,
-0.002439318735208101,
-0.002694705924877506,
-0.0019398041036794904,
-0.0005009204529823168,
0.0010572749277538746,
0.002151904340153304,
0.0023987473866366694,
0.0017454690431127737,
0.0004756514378608688,
-0.0009117309558985052,
-0.0018972251744157108,
-0.0021343148817604537,
-0.0015698651486301504,
-0.00045018906538656344,
0.0007841224796464358,
0.0016705190528383644,
0.0018969095024372164,
0.001410317281514996,
0.0004243711264276928,
-0.0006723342545725874,
-0.0014684721212733468,
-0.0016834392177065517,
-0.0012651632658027155,
-0.00039855658847037984,
0.0005742251236691491,
0.0012880415983195486,
0.001491108991609888,
0.0011328440839743217,
0.0003728983777711915,
-0.00048810081017726934,
-0.00112672459734785,
-0.00131759054013331,
-0.0010120409764540587,
-0.0003474809569233346,
0.00041262562806862577,
0.0009825216562031713,
0.0011610073442692797,
0.0009016983083906841,
0.00032241792960683256,
-0.0003466313282958727,
-0.0008537228807992812,
-0.0010197901001975135,
-0.0008009639879952011,
-0.00029785371890452667,
0.0002890888341725964,
0.0007388370199409955,
0.0008925504915763667,
0.000709103059810356,
0.00027391522463083456,
-0.0002390663542142938,
-0.0006365186915251346,
-0.000778091847475933,
-0.0006254195152882695,
-0.00025074213743846857,
0.00019574147116968918,
0.0005455940710153611,
0.0006752875891558256,
0.0005493256107524179,
0.00022839019289237243,
-0.00015840098545483847,
-0.0004649929238115654,
-0.0005831618463225034,
-0.00048027292277884754,
-0.0002069328024442442,
0.00012644384781839853,
0.00039382669238327805,
0.000500864607721646,
0.0004177818231984341,
0.00018645193908209287,
-9.926550983683102e-05,
-0.00033122877848323397,
-0.0004276123819887451,
-0.0003614263201799131,
-0.00016701231204550355,
7.634416838275095e-05,
0.0002764086208137364,
0.0003626385302978364,
0.0003107601137474576,
0.0001486489144024993,
-5.7201132203636456e-05,
-0.00022865773525297475,
-0.0003052881461226832,
-0.00026542582845891916,
-0.00013142989301547756,
4.1363165213668975e-05,
0.00018726796772127336,
0.0002548620717139718,
0.00022502794915481183,
0.00011533259080876172,
-2.8465172147687425e-05,
-0.00015159356431734114,
-0.00021084602382096792,
-0.0001891631140968354,
-0.00010044750045102252,
1.8120456685423787e-05,
0.00012118754255503934,
0.0001725594435567163,
0.00015752965031084936,
8.66845042794267e-05,
-9.988415183929545e-06,
-9.542270322675681e-05,
-0.0001395944530040779,
-0.00012981435123603867,
-7.401805979045885e-05,
3.865951248137725e-06,
7.386768414899316e-05,
0.0001114016598748754,
0.00010566812145669043,
6.243816098384975e-05,
5.052577304131818e-07,
-5.6189002068144863e-05,
-8.769956331509131e-05,
-8.489610072249166e-05,
-5.184652785067904e-05,
-3.137610177449979e-06,
4.228625562544283e-05,
6.836603129366665e-05,
6.740265708245563e-05,
4.209753196961257e-05,
3.6343548552951894e-06,
-3.300000601780741e-05,
-5.464014069634055e-05,
-5.430582462814517e-05,
-3.303156454135562e-05,
1.3334116578110678e-06,
3.7466211871742756e-05,
6.476841767566013e-05,
7.680362841199955e-05,
7.317347502069934e-05,
6.0028929683799436e-05,
5.193916271655597e-05,
-2.074177292689992e-05]

a_pa_fir = np.array([1])
#FSB = 0.0005 ; FSA = 0.005; ASB = 80 ; APB = 0.01; N = 824
b_pa_fir = [-0.00037430249004919,
-2.014431488473662e-05,
-2.0666385971588273e-05,
-2.115203583015528e-05,
-2.1647882109142778e-05,
-2.2106054041616422e-05,
-2.2574615937800622e-05,
-2.30059273632172e-05,
-2.344628560228474e-05,
-2.384933576225652e-05,
-2.4263333192734865e-05,
-2.4638444844341193e-05,
-2.5026162427830484e-05,
-2.5374105379860547e-05,
-2.573460807756496e-05,
-2.6050444573896044e-05,
-2.6379038586898494e-05,
-2.665631367047015e-05,
-2.694280079452799e-05,
-2.7167393957345654e-05,
-2.7398402573829847e-05,
-2.7552921556074185e-05,
-2.7710135598344345e-05,
-2.7776551059539705e-05,
-2.7851045955322147e-05,
-2.7824599169836494e-05,
-2.7834110956727582e-05,
-2.7748624828336267e-05,
-2.7770192985941823e-05,
-2.771554679051613e-05,
-2.7925924105315688e-05,
-2.787732112579725e-05,
-2.6947937513826623e-05,
-2.7194228203724442e-05,
-2.6789383054689802e-05,
-2.6547523572152052e-05,
-2.6129551764999698e-05,
-2.576680098873085e-05,
-2.5272444420926907e-05,
-2.47975504772382e-05,
-2.421135098239978e-05,
-2.3626679335361213e-05,
-2.2940375786323073e-05,
-2.224708340682217e-05,
-2.1458963819169674e-05,
-2.0657135338217916e-05,
-1.9765554176574223e-05,
-1.8857822197746348e-05,
-1.786127231967111e-05,
-1.6843758561896007e-05,
-1.573573638080769e-05,
-1.460032344919429e-05,
-1.3365728883159914e-05,
-1.2096570695169828e-05,
-1.0721141618216038e-05,
-9.310300263853287e-06,
-7.793221475095441e-06,
-6.257490661409662e-06,
-4.624331875211322e-06,
-2.9973666564638078e-06,
-1.2586786439675897e-06,
4.898710962709289e-07,
2.5076537573780473e-06,
4.510329983278379e-06,
6.385936413994464e-06,
8.585156203182225e-06,
1.0712506163115495e-05,
1.2984467661066066e-05,
1.5281162945896937e-05,
1.7691543527595646e-05,
2.0146886036200017e-05,
2.2704777161576404e-05,
2.531956368810211e-05,
2.803156716531369e-05,
3.0804989895842344e-05,
3.367344424804929e-05,
3.6605461648548646e-05,
3.962748865211322e-05,
4.271294334186336e-05,
4.5887168830713166e-05,
4.912466899421433e-05,
5.245103518815663e-05,
5.5844707094942144e-05,
5.9331958126508523e-05,
6.288826938651906e-05,
6.653984053055955e-05,
7.025640761565904e-05,
7.40619131875163e-05,
7.791980246055289e-05,
8.186433170603531e-05,
8.58588558912474e-05,
8.996516727135666e-05,
9.414112228702274e-05,
9.845251089533899e-05,
0.00010271469143367914,
0.00010709285665025165,
0.000111608832392803,
0.00011610774580636051,
0.00012073271285876286,
0.0001253892230009222,
0.00013014056616431129,
0.00013493406716560236,
0.0001398129919239072,
0.00014473941904580347,
0.00014974348886566337,
0.00015479657543073508,
0.00015992286312891256,
0.00016509470394727806,
0.0001703327163988101,
0.00017561400040086366,
0.00018095642806913889,
0.00018633830776113825,
0.00019177931587701597,
0.00019725999604288543,
0.00020279739567488872,
0.00020836996324320836,
0.0002139934898967379,
0.00021964212312770856,
0.00022533152999326613,
0.00023103796172652585,
0.00023678593157654823,
0.00024255385204008132,
0.0002483746096380073,
0.0002542057763120469,
0.0002600629373169171,
0.00026587927122680117,
0.00027179304375807826,
0.00027768182304261377,
0.0002835615099741745,
0.00028947327127194967,
0.00029536558210119853,
0.0003012684003856744,
0.000307153986711061,
0.0003130402765226413,
0.0003189056548021257,
0.00032476139910452717,
0.00033059278263546793,
0.00033640428461254,
0.0003421821517307744,
0.0003479311599632508,
0.00035363977362272577,
0.00035930996652399234,
0.0003649331887057083,
0.00037051309513201294,
0.00037603997062818074,
0.00038151414905282293,
0.0003869250877269051,
0.0003922714469550381,
0.00039754100820853445,
0.0004027357139863456,
0.0004078475758537285,
0.00041288214242457533,
0.0004178296210903451,
0.0004226912890971242,
0.0004274409195838226,
0.00043208351998972125,
0.00043661427766708257,
0.0004410756594277298,
0.00044536425592119186,
0.0004495566766585966,
0.0004536209221287228,
0.00045754366903877597,
0.00046133439459963377,
0.0004649767027045015,
0.000468476380825565,
0.00047181700963223893,
0.00047500465046709334,
0.00047802416849456933,
0.000480875939192602,
0.0004835483559139475,
0.0004860427687801149,
0.0004883469681353314,
0.0004904618997182444,
0.0004923793397603614,
0.0004940991298673738,
0.0004956101619145643,
0.0004969107107373888,
0.0004979900587750219,
0.0004988452232328219,
0.0004994671740654291,
0.0004998567901830866,
0.0005000067215163192,
0.0004999162282051467,
0.0004995741891819774,
0.0004989741966654625,
0.0004981036442355852,
0.0004969712597734546,
0.0004955751165351052,
0.0004939062878166504,
0.0004919212131547954,
0.0004896868470316018,
0.0004871351394253053,
0.0004842932192548186,
0.00048114403586078345,
0.00047768978060774066,
0.00047391999633275295,
0.00046983327496553424,
0.00046542371895776834,
0.00046068474976329235,
0.00045561038272762136,
0.0004501982610140048,
0.00044444135214086704,
0.00043833629962782234,
0.0004318789663081241,
0.00042506755508535295,
0.00041789423412807335,
0.00041035571472866666,
0.00040244508818028607,
0.0003941596012938491,
0.0003854923921794655,
0.00037644400921187814,
0.00036700899907679736,
0.00035718647718297527,
0.0003469680494156206,
0.00033635102689465765,
0.0003253262841181922,
0.0003138987789165065,
0.0003020668987145251,
0.0002898273170734503,
0.0002771592291963666,
0.00026407119447666464,
0.000250581580321643,
0.00023664171844540118,
0.00022229072905180798,
0.00020750134420672892,
0.0001922857853741976,
0.0001766308962550927,
0.00016054325386285717,
0.00014401426038065457,
0.00012704297932480374,
0.00010962776371024782,
9.176803565243176e-05,
7.346006065701246e-05,
5.470484454478462e-05,
3.550199382163204e-05,
1.5849753863464522e-05,
-4.255155514122697e-06,
-2.481278553859095e-05,
-4.582483940751352e-05,
-6.729135628697547e-05,
-8.921276949276973e-05,
-0.00011158674212468438,
-0.0001344152669182408,
-0.000157697727865248,
-0.0001814371510249973,
-0.0002056315187156218,
-0.0002302810387432205,
-0.0002553774906762181,
-0.00028092573153898283,
-0.000306927434015743,
-0.0003333871445392861,
-0.0003602837043463457,
-0.0003876287036380428,
-0.00041543305702392263,
-0.00044366396616470305,
-0.0004723487859370539,
-0.0005014634847661365,
-0.0005310228254952887,
-0.0005610091192915564,
-0.0005914349075646111,
-0.0006222864243059714,
-0.0006535667344580449,
-0.0006852678964297358,
-0.0007173917488645455,
-0.0007499270805980819,
-0.0007828758165698859,
-0.0008162314168947484,
-0.0008499943295094556,
-0.00088415506255728,
-0.0009187140074109502,
-0.0009536618563975723,
-0.000988997251505369,
-0.0010247108127946377,
-0.001060803472753143,
-0.0010972655788470318,
-0.0011340970308513704,
-0.0011712855205829582,
-0.0012088287719673682,
-0.001246714323952563,
-0.0012849481475138804,
-0.0013235172205557123,
-0.0013624179983589236,
-0.0014016306002245028,
-0.0014411735086217474,
-0.0014810204538324614,
-0.0015211635122835674,
-0.0015616086206234755,
-0.0016023341034887347,
-0.001643344418023432,
-0.0016846218402512074,
-0.0017261706098538176,
-0.0017679705650721325,
-0.0018100216137352395,
-0.0018523115334347217,
-0.001894833429314423,
-0.001937574959143395,
-0.0019805328403347255,
-0.0020236962326694893,
-0.0020670568326578024,
-0.002110603499722753,
-0.002154329377878337,
-0.0021982227108890812,
-0.002242275505581582,
-0.0022864775988581296,
-0.00233082169886342,
-0.002375295731342454,
-0.002419891183401155,
-0.0024645943183485165,
-0.002509397213238026,
-0.002554289361016065,
-0.0025992662460476187,
-0.0026443095874127674,
-0.0026894114194633907,
-0.002734559766411987,
-0.0027797564607266565,
-0.0028249672745162087,
-0.0028701991224772774,
-0.0029154371296258455,
-0.002960665879624376,
-0.003005881591113041,
-0.0030510669728064164,
-0.003096218995219954,
-0.0031413142879594264,
-0.0031863545139597586,
-0.00323131849743644,
-0.0032761998974432777,
-0.003320983855235208,
-0.0033656659837929368,
-0.0034102279104401096,
-0.0034546619712304957,
-0.003498953517132707,
-0.003543095296507646,
-0.003587071260786019,
-0.0036308744838163378,
-0.0036744905833447587,
-0.0037179113452662756,
-0.0037611208610268503,
-0.0038041107609827593,
-0.003846865204762284,
-0.0038893782379535516,
-0.003931636245847044,
-0.003973631095068141,
-0.004015343591574217,
-0.004056770675481915,
-0.0040978980415676235,
-0.004138717872147953,
-0.004179203427532606,
-0.004219367751764128,
-0.004259179580975558,
-0.004298639934176828,
-0.004337732333194303,
-0.004376450122955271,
-0.004414778655362065,
-0.004452706753921692,
-0.0044902296561415,
-0.0045273286260661,
-0.004563998382141467,
-0.004600228688905564,
-0.004636009670438085,
-0.004671327293054477,
-0.004706174325187805,
-0.0047405407832079105,
-0.004774416958746417,
-0.004807792447586838,
-0.004840659254924499,
-0.0048730073840788915,
-0.004904826926888191,
-0.004936108031522325,
-0.004966841507884807,
-0.004997018829636142,
-0.0050266330667432775,
-0.005055675278569243,
-0.005084135268850102,
-0.005112004789859043,
-0.005139279579571539,
-0.005165948572825133,
-0.005192001239369338,
-0.005217430002841492,
-0.00524223861235899,
-0.005266401966906143,
-0.005289929689556661,
-0.005312803271734406,
-0.005335024180035965,
-0.005356577111279676,
-0.005377463445923108,
-0.005397674622489356,
-0.005417199857022627,
-0.005436041660004139,
-0.005454189949370081,
-0.005471639123817578,
-0.005488381816386997,
-0.005504418230351514,
-0.005519740285093839,
-0.005534344934076317,
-0.0055482264543278625,
-0.005561383326339582,
-0.005573808663270778,
-0.0055854999876615765,
-0.005596451934057388,
-0.005606662978708952,
-0.0056161296203119685,
-0.005624851111252635,
-0.005632822186970114,
-0.0056400412931749,
-0.005646507012764285,
-0.0056522185123767795,
-0.0056571691429719234,
-0.005661359276009095,
-0.005664790896989717,
-0.00566746368244433,
-0.0056693670949295675,
-0.005670516380596185,
0.9943291050246613,
-0.005670516380596185,
-0.0056693670949295675,
-0.00566746368244433,
-0.005664790896989717,
-0.005661359276009095,
-0.0056571691429719234,
-0.0056522185123767795,
-0.005646507012764285,
-0.0056400412931749,
-0.005632822186970114,
-0.005624851111252635,
-0.0056161296203119685,
-0.005606662978708952,
-0.005596451934057388,
-0.0055854999876615765,
-0.005573808663270778,
-0.005561383326339582,
-0.0055482264543278625,
-0.005534344934076317,
-0.005519740285093839,
-0.005504418230351514,
-0.005488381816386997,
-0.005471639123817578,
-0.005454189949370081,
-0.005436041660004139,
-0.005417199857022627,
-0.005397674622489356,
-0.005377463445923108,
-0.005356577111279676,
-0.005335024180035965,
-0.005312803271734406,
-0.005289929689556661,
-0.005266401966906143,
-0.00524223861235899,
-0.005217430002841492,
-0.005192001239369338,
-0.005165948572825133,
-0.005139279579571539,
-0.005112004789859043,
-0.005084135268850102,
-0.005055675278569243,
-0.0050266330667432775,
-0.004997018829636142,
-0.004966841507884807,
-0.004936108031522325,
-0.004904826926888191,
-0.0048730073840788915,
-0.004840659254924499,
-0.004807792447586838,
-0.004774416958746417,
-0.0047405407832079105,
-0.004706174325187805,
-0.004671327293054477,
-0.004636009670438085,
-0.004600228688905564,
-0.004563998382141467,
-0.0045273286260661,
-0.0044902296561415,
-0.004452706753921692,
-0.004414778655362065,
-0.004376450122955271,
-0.004337732333194303,
-0.004298639934176828,
-0.004259179580975558,
-0.004219367751764128,
-0.004179203427532606,
-0.004138717872147953,
-0.0040978980415676235,
-0.004056770675481915,
-0.004015343591574217,
-0.003973631095068141,
-0.003931636245847044,
-0.0038893782379535516,
-0.003846865204762284,
-0.0038041107609827593,
-0.0037611208610268503,
-0.0037179113452662756,
-0.0036744905833447587,
-0.0036308744838163378,
-0.003587071260786019,
-0.003543095296507646,
-0.003498953517132707,
-0.0034546619712304957,
-0.0034102279104401096,
-0.0033656659837929368,
-0.003320983855235208,
-0.0032761998974432777,
-0.00323131849743644,
-0.0031863545139597586,
-0.0031413142879594264,
-0.003096218995219954,
-0.0030510669728064164,
-0.003005881591113041,
-0.002960665879624376,
-0.0029154371296258455,
-0.0028701991224772774,
-0.0028249672745162087,
-0.0027797564607266565,
-0.002734559766411987,
-0.0026894114194633907,
-0.0026443095874127674,
-0.0025992662460476187,
-0.002554289361016065,
-0.002509397213238026,
-0.0024645943183485165,
-0.002419891183401155,
-0.002375295731342454,
-0.00233082169886342,
-0.0022864775988581296,
-0.002242275505581582,
-0.0021982227108890812,
-0.002154329377878337,
-0.002110603499722753,
-0.0020670568326578024,
-0.0020236962326694893,
-0.0019805328403347255,
-0.001937574959143395,
-0.001894833429314423,
-0.0018523115334347217,
-0.0018100216137352395,
-0.0017679705650721325,
-0.0017261706098538176,
-0.0016846218402512074,
-0.001643344418023432,
-0.0016023341034887347,
-0.0015616086206234755,
-0.0015211635122835674,
-0.0014810204538324614,
-0.0014411735086217474,
-0.0014016306002245028,
-0.0013624179983589236,
-0.0013235172205557123,
-0.0012849481475138804,
-0.001246714323952563,
-0.0012088287719673682,
-0.0011712855205829582,
-0.0011340970308513704,
-0.0010972655788470318,
-0.001060803472753143,
-0.0010247108127946377,
-0.000988997251505369,
-0.0009536618563975723,
-0.0009187140074109502,
-0.00088415506255728,
-0.0008499943295094556,
-0.0008162314168947484,
-0.0007828758165698859,
-0.0007499270805980819,
-0.0007173917488645455,
-0.0006852678964297358,
-0.0006535667344580449,
-0.0006222864243059714,
-0.0005914349075646111,
-0.0005610091192915564,
-0.0005310228254952887,
-0.0005014634847661365,
-0.0004723487859370539,
-0.00044366396616470305,
-0.00041543305702392263,
-0.0003876287036380428,
-0.0003602837043463457,
-0.0003333871445392861,
-0.000306927434015743,
-0.00028092573153898283,
-0.0002553774906762181,
-0.0002302810387432205,
-0.0002056315187156218,
-0.0001814371510249973,
-0.000157697727865248,
-0.0001344152669182408,
-0.00011158674212468438,
-8.921276949276973e-05,
-6.729135628697547e-05,
-4.582483940751352e-05,
-2.481278553859095e-05,
-4.255155514122697e-06,
1.5849753863464522e-05,
3.550199382163204e-05,
5.470484454478462e-05,
7.346006065701246e-05,
9.176803565243176e-05,
0.00010962776371024782,
0.00012704297932480374,
0.00014401426038065457,
0.00016054325386285717,
0.0001766308962550927,
0.0001922857853741976,
0.00020750134420672892,
0.00022229072905180798,
0.00023664171844540118,
0.000250581580321643,
0.00026407119447666464,
0.0002771592291963666,
0.0002898273170734503,
0.0003020668987145251,
0.0003138987789165065,
0.0003253262841181922,
0.00033635102689465765,
0.0003469680494156206,
0.00035718647718297527,
0.00036700899907679736,
0.00037644400921187814,
0.0003854923921794655,
0.0003941596012938491,
0.00040244508818028607,
0.00041035571472866666,
0.00041789423412807335,
0.00042506755508535295,
0.0004318789663081241,
0.00043833629962782234,
0.00044444135214086704,
0.0004501982610140048,
0.00045561038272762136,
0.00046068474976329235,
0.00046542371895776834,
0.00046983327496553424,
0.00047391999633275295,
0.00047768978060774066,
0.00048114403586078345,
0.0004842932192548186,
0.0004871351394253053,
0.0004896868470316018,
0.0004919212131547954,
0.0004939062878166504,
0.0004955751165351052,
0.0004969712597734546,
0.0004981036442355852,
0.0004989741966654625,
0.0004995741891819774,
0.0004999162282051467,
0.0005000067215163192,
0.0004998567901830866,
0.0004994671740654291,
0.0004988452232328219,
0.0004979900587750219,
0.0004969107107373888,
0.0004956101619145643,
0.0004940991298673738,
0.0004923793397603614,
0.0004904618997182444,
0.0004883469681353314,
0.0004860427687801149,
0.0004835483559139475,
0.000480875939192602,
0.00047802416849456933,
0.00047500465046709334,
0.00047181700963223893,
0.000468476380825565,
0.0004649767027045015,
0.00046133439459963377,
0.00045754366903877597,
0.0004536209221287228,
0.0004495566766585966,
0.00044536425592119186,
0.0004410756594277298,
0.00043661427766708257,
0.00043208351998972125,
0.0004274409195838226,
0.0004226912890971242,
0.0004178296210903451,
0.00041288214242457533,
0.0004078475758537285,
0.0004027357139863456,
0.00039754100820853445,
0.0003922714469550381,
0.0003869250877269051,
0.00038151414905282293,
0.00037603997062818074,
0.00037051309513201294,
0.0003649331887057083,
0.00035930996652399234,
0.00035363977362272577,
0.0003479311599632508,
0.0003421821517307744,
0.00033640428461254,
0.00033059278263546793,
0.00032476139910452717,
0.0003189056548021257,
0.0003130402765226413,
0.000307153986711061,
0.0003012684003856744,
0.00029536558210119853,
0.00028947327127194967,
0.0002835615099741745,
0.00027768182304261377,
0.00027179304375807826,
0.00026587927122680117,
0.0002600629373169171,
0.0002542057763120469,
0.0002483746096380073,
0.00024255385204008132,
0.00023678593157654823,
0.00023103796172652585,
0.00022533152999326613,
0.00021964212312770856,
0.0002139934898967379,
0.00020836996324320836,
0.00020279739567488872,
0.00019725999604288543,
0.00019177931587701597,
0.00018633830776113825,
0.00018095642806913889,
0.00017561400040086366,
0.0001703327163988101,
0.00016509470394727806,
0.00015992286312891256,
0.00015479657543073508,
0.00014974348886566337,
0.00014473941904580347,
0.0001398129919239072,
0.00013493406716560236,
0.00013014056616431129,
0.0001253892230009222,
0.00012073271285876286,
0.00011610774580636051,
0.000111608832392803,
0.00010709285665025165,
0.00010271469143367914,
9.845251089533899e-05,
9.414112228702274e-05,
8.996516727135666e-05,
8.58588558912474e-05,
8.186433170603531e-05,
7.791980246055289e-05,
7.40619131875163e-05,
7.025640761565904e-05,
6.653984053055955e-05,
6.288826938651906e-05,
5.9331958126508523e-05,
5.5844707094942144e-05,
5.245103518815663e-05,
4.912466899421433e-05,
4.5887168830713166e-05,
4.271294334186336e-05,
3.962748865211322e-05,
3.6605461648548646e-05,
3.367344424804929e-05,
3.0804989895842344e-05,
2.803156716531369e-05,
2.531956368810211e-05,
2.2704777161576404e-05,
2.0146886036200017e-05,
1.7691543527595646e-05,
1.5281162945896937e-05,
1.2984467661066066e-05,
1.0712506163115495e-05,
8.585156203182225e-06,
6.385936413994464e-06,
4.510329983278379e-06,
2.5076537573780473e-06,
4.898710962709289e-07,
-1.2586786439675897e-06,
-2.9973666564638078e-06,
-4.624331875211322e-06,
-6.257490661409662e-06,
-7.793221475095441e-06,
-9.310300263853287e-06,
-1.0721141618216038e-05,
-1.2096570695169828e-05,
-1.3365728883159914e-05,
-1.460032344919429e-05,
-1.573573638080769e-05,
-1.6843758561896007e-05,
-1.786127231967111e-05,
-1.8857822197746348e-05,
-1.9765554176574223e-05,
-2.0657135338217916e-05,
-2.1458963819169674e-05,
-2.224708340682217e-05,
-2.2940375786323073e-05,
-2.3626679335361213e-05,
-2.421135098239978e-05,
-2.47975504772382e-05,
-2.5272444420926907e-05,
-2.576680098873085e-05,
-2.6129551764999698e-05,
-2.6547523572152052e-05,
-2.6789383054689802e-05,
-2.7194228203724442e-05,
-2.6947937513826623e-05,
-2.787732112579725e-05,
-2.7925924105315688e-05,
-2.771554679051613e-05,
-2.7770192985941823e-05,
-2.7748624828336267e-05,
-2.7834110956727582e-05,
-2.7824599169836494e-05,
-2.7851045955322147e-05,
-2.7776551059539705e-05,
-2.7710135598344345e-05,
-2.7552921556074185e-05,
-2.7398402573829847e-05,
-2.7167393957345654e-05,
-2.694280079452799e-05,
-2.665631367047015e-05,
-2.6379038586898494e-05,
-2.6050444573896044e-05,
-2.573460807756496e-05,
-2.5374105379860547e-05,
-2.5026162427830484e-05,
-2.4638444844341193e-05,
-2.4263333192734865e-05,
-2.384933576225652e-05,
-2.344628560228474e-05,
-2.30059273632172e-05,
-2.2574615937800622e-05,
-2.2106054041616422e-05,
-2.1647882109142778e-05,
-2.115203583015528e-05,
-2.0666385971588273e-05,
-2.014431488473662e-05,
-0.00037430249004919]

#FSB = 0.0005; FSA = 0.001; ASB = 60; ASA = 0.01
a_pa_iir = [1.0,
-5.983310156416412,
14.916677376897578,
-19.833607380199652,
14.833859444943322,
-5.917055474793318,
0.9834361895684886
]

b_pa_iir = [0.9916866566065438,
-5.950119939639262,
14.875299849098155,
-19.833733132130874,
14.875299849098155,
-5.950119939639262,
0.9916866566065438]


#FSB = 0.095; FSA = 0.125; ASB = 0.1; ASA = 60
a_pb_iir = [1.0,
-14.18008452809512,
97.69272204197486,
-434.7165761783069,
1401.4337991800662,
-3480.687244313838,
6915.577696668685,
-11267.580548330803,
15312.654894685007,
-17563.556353501757,
17140.46259358803,
-14306.688404695757,
10242.07412333303,
-6293.236287539021,
3314.4841693764374,
-1491.1060576043583,
569.6498132901497,
-183.19490683388767,
48.97701450446648,
-10.694002450645426,
1.8588368254609569,
-0.24749849036175028,
0.023714558481497224,
-0.0014562720156000243,
4.305959950756792e-05
]

b_pb_iir = [2.220523451881621e-14,
5.329256284515892e-13,
6.1286447271932746e-12,
4.494339466608401e-11,
2.35952821996941e-10,
9.438112879877643e-10,
2.988735745294587e-09,
7.685320487900366e-09,
1.6331306036788276e-08,
2.903343295429027e-08,
4.3550149431435405e-08,
5.5427462912735975e-08,
6.004641815546397e-08,
5.5427462912735975e-08,
4.3550149431435405e-08,
2.903343295429027e-08,
1.6331306036788276e-08,
7.685320487900365e-09,
2.9887357452945864e-09,
9.438112879877643e-10,
2.3595282199694107e-10,
4.4943394666084005e-11,
6.128644727193274e-12,
5.329256284515892e-13,
2.220523451881621e-14]

yPBFIR = sig.lfilter(b_pb_fir,a_pb_fir,ecg_lead.flatten())

yPAFIR = sig.lfilter(b_pa_fir,a_pa_fir,yPBFIR.flatten())

yPBIIR = sig.lfilter(b_pb_iir,a_pb_iir,ecg_lead.flatten())

yPAIIR = sig.lfilter(b_pa_iir,a_pa_iir,yPBIIR.flatten())

plt.figure(0)
plt.plot(tt, ecg_lead[ecg_In:ecg_Fin],label="Original")
plt.plot(tt, yPBFIR[ecg_In:ecg_Fin], label="PB_FIR")
plt.plot(tt, yPAFIR[ecg_In:ecg_Fin], label="PA_FIR")
#plt.plot(tt, yPBIIR[ecg_In:ecg_Fin], label="PB_IIR")
#plt.plot(tt, yPAIIR[ecg_In:ecg_Fin], label="PA_IIR")

plt.title('Registro ECG')
plt.xlabel('Tiempo en Segundos')
plt.ylabel('Amplitud')
plt.grid(which='both', axis='both')

axes_hdl = plt.gca()
axes_hdl.legend()

ff = np.linspace(0.0, fs/2, N/2).flatten()

spectrum = np.abs(sc.fft(ecg_lead[ecg_In:ecg_Fin], axis=0))
spectrum = (1/max(spectrum))*spectrum
halfSpectrum = spectrum[:N//2] 

spectrumYPBFIR = np.abs(sc.fft(yPBFIR[ecg_In:ecg_Fin], axis=0))
spectrumYPBFIR = (1/max(spectrumYPBFIR))*spectrumYPBFIR
halfSpectrumYPBFIR = spectrumYPBFIR[:N//2] 

spectrumYPAFIR = np.abs(sc.fft(yPAFIR[ecg_In:ecg_Fin], axis=0))
spectrumYPAFIR = (1/max(spectrumYPAFIR))*spectrumYPAFIR
halfSpectrumYPAFIR = spectrumYPAFIR[:N//2] 

spectrumYPBIIR = np.abs(sc.fft(yPBIIR[ecg_In:ecg_Fin], axis=0))
spectrumYPBIIR = (1/max(spectrumYPBIIR))*spectrumYPBIIR
halfSpectrumYPBIIR = spectrumYPBIIR[:N//2] 

spectrumYPAIIR = np.abs(sc.fft(yPAIIR[ecg_In:ecg_Fin], axis=0))
spectrumYPAIIR = (1/max(spectrumYPAIIR))*spectrumYPAIIR
halfSpectrumYPAIIR = spectrumYPAIIR[:N//2] 

plt.figure(1)

plt.plot(ff, halfSpectrum, label="Original")
plt.plot(ff, halfSpectrumYPBFIR, label="PB_FIR")
plt.plot(ff, halfSpectrumYPAFIR, label="PA_FIR")
#plt.plot(ff, halfSpectrumYPBIIR, label="PB_IIR")
#plt.plot(ff, halfSpectrumYPAIIR, label="PA_IIR")

plt.title('FFT: Registro ECG')
plt.xlabel('Frecuencia [Hz]')
plt.ylabel('Amplitud Normalizada')
plt.grid(which='both', axis='both')

axes_hdl = plt.gca()
axes_hdl.legend()
